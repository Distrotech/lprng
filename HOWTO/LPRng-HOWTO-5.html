<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> LPRng-HOWTO: System Specific Notes</TITLE>
 <LINK HREF="LPRng-HOWTO-6.html" REL=next>
 <LINK HREF="LPRng-HOWTO-4.html" REL=previous>
 <LINK HREF="LPRng-HOWTO.html#toc5" REL=contents>
</HEAD>
<BODY>
<A HREF="LPRng-HOWTO-6.html">Next</A>
<A HREF="LPRng-HOWTO-4.html">Previous</A>
<A HREF="LPRng-HOWTO.html#toc5">Contents</A>
<HR>
<H2><A NAME="sysdep"></A> <A NAME="s5">5. System Specific Notes</A></H2>

<P>The following are a set of suggestions and recommendations for
specific systems.
<H2><A NAME="solarisinstall"></A> <A NAME="ss5.1">5.1 Solaris 2.4, 2.5, 2.6, 2.7</A>
</H2>

<P>The Sun Solaris operating system is derived from the System V UNIX
baseline.
Use the following installation procedure.
<OL>
<LI>First,
install the LPRng software
and then rename all of the existing Solaris print facilities.
See the
<A HREF="LPRng-HOWTO-4.html#installation">Installation</A> section for details.
You should especially look out for
<CODE>lp</CODE>,
<CODE>lpstat</CODE>,
<CODE>lpsched</CODE>,
<CODE>lpadmin</CODE>,
and other executables used by Solaris for print support.</LI>
<LI>You may need to remove the <CODE>printer</CODE> entry in the
<CODE>/etc/inetd.conf</CODE> file.
Make sure it is removed.</LI>
<LI><EM>Reboot</EM>.
Don't try to be fancy and kill off processes,
use the <EM>nlsadmin</EM> command,
or other insanity.
This is brutal,  but appears to be necessary in order to ensure
that the networking support is set up correctly.</LI>
<LI>When the system restarts, try using <CODE>lpq</CODE>
to check to see if the <CODE>lpd</CODE> server is active.</LI>
</OL>
<P>James P. Dugal <CODE>&lt;jpd@usl.ed&gt;</CODE> has also made the following
suggestions as well.
<BLOCKQUOTE><CODE>
<PRE>
From: "Dugal James P." &lt;jpd@usl.edu>
To: lprng@iona.com
Subject: Re: [LPRng] start up trouble

Here are some more tips for Solaris:

1. If /var/spool/cron/crontabs/lp exists, remove it.

In fact, we actually test if /etc/init.d/lp exists on any newly-installed
system, and if so, we issue these commands:
        /etc/init.d/lp stop
        /usr/sbin/pkgrm -n SUNWpsu
        /usr/sbin/pkgrm -n SUNWscplp
        /usr/sbin/pkgrm -n SUNWpcu
        /usr/sbin/pkgrm -n SUNWpsr
        /usr/sbin/pkgrm -n SUNWpcr
        /bin/rm -f /var/spool/cron/crontabs/lp

Regards,
-- James Dugal, N5KNX           Internet: jpd@usl.edu
Associate Director              Ham packet: n5knx@k5arh.#lft.la.usa.noam
Computing Support Services      US Mail: PO Box 42770  Lafayette, LA  70504
University of Southwestern LA.  Tel. 318-482-6417       U.S.A.
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss5.2">5.2 Solaris, Newsprint and FrameMaker</A>
</H2>

<P>The following is a guide to using LPRng and
Sun Microsystems Newsprint by
Christopher Hylands, Ptolemy Project Manager
of the University of California.
<P>The Sun Newsprint printer is actually
an OEM version of the  Tektronix PhaserII;
Sun Microsystems appears to have dropped support for Newsprint,
and the recommended migration path is to buy a PostScript printer.
If you want more information on using the Newsprint system,
notes are available via
<CODE>http://ptolemy.eecs.berkeley.edu/~cxh/lprng.html</CODE>.
<P>Looking through the mailing list logs, it looks like everyone was
having a hard time getting lprng to work with Sun's brain-dead
newsprinters.  I tried using GhostScript, but the fonts were, IMHO,
ugly, so I spent a little time getting the newsprint fonts to work.
<P>The key thing was to grab the file
<CODE>/usr/newsprint/lpd/if</CODE>
from a SunOS4.1.3 newsprint installation.
If you cannot get this code,
then the installation will be extremely difficult.
<P>To install lprng on a Solaris2.x machine,
you need to first stop the existing print services and install the
startup scripts for LPRng.
Note that if there is a local printer, you may have
to also fix the permissions of the device. Typical commands are:
<BLOCKQUOTE><CODE>
<PRE>
chown daemon /devices/sbus@1,f8000000/SUNW,lpvi@1,300000:lpvi0
</PRE>
</CODE></BLOCKQUOTE>
<P>We use the following simple <CODE>if</CODE> script.
<BLOCKQUOTE><CODE>
<PRE>
#/bin/sh
# extremely simple filter script
/bin/cat
</PRE>
</CODE></BLOCKQUOTE>
<P>The Sparcprinters use licensed fonts from NeWSprint. To use the
licensed fonts, you must have the lprng spool directory for the
sparcprinter in the same location as spool directory of the brain
dead Solaris lp system.  If your printer is named xsp524, then this
directory would be <CODE> /etc/lp/printers/xsp524</CODE>.
<P>The printcap entry looks like:
<BLOCKQUOTE><CODE>
<PRE>
sp524|524:
    :mx=0:sf:sh:sb:
    :lp=:rm=doppler:rp=xsp524:
    :sd=/var/spool/lpd/sp524d:
    :lf=/var/spool/lpd/sp524d/log:
xsp524|Sun SPARCprinter NeWSprint printer:
    :mx=0:sf:sb:sh:rs:
    :lp=/dev/lpvi0:
    :sd=/etc/lp/printers/xsp524:
    :lf=/etc/lp/printers/xsp524/log:
    :af=/var/spool/lpd/xsp524/acct:
    :if=/usr/local/lib/newsprint/if:
</PRE>
</CODE></BLOCKQUOTE>
<P>The
<CODE>/usr/local/lib/newsprint/if</CODE>
was copied from
<CODE>/usr/newsprint/lpd/if</CODE>
in a SunOS4.x installation of the newsprint
software.
Unfortunately, the newsprint engine is so brain dead that it
needs many environment variables set, so it is fairly difficult to
come up with a clean script to start the engine. I made the following
changes to the file.
<OL>
<LI>First, set the path in the script.
You may also need to change defaults to suit your preferences:
<BLOCKQUOTE><CODE>
<PRE>
PATH=/usr/ucb:/usr/bin:/etc:/usr/etc:/opt/NeWSprint/bin:/opt/NeWSprint/np/bin:
PATH=$PATH:$NPHOME/pl.$ARCH/bin:$NPHOME/np/bin; export PATH
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>You will also need a
<CODE>/etc/lp/printers/printername/.params</CODE>
file. If you
are using the same spooler directory as the directory that the Solaris
lp system uses, then the .param file should appear there. If you are
using a different spooler directory, then you will need to copy
the .param file from elsewhere and edit it accordingly.</LI>
<LI>If you are going to move a license to a new printer, you should
probably save the .param file in the old printer spooler directory.
Run /opt/NeWSprint/bin/fp_install and remove the license from the
old printer and assign it to the new printer.
You could run /opt/NeWSprint/bin/rm_np_printer and remove the printer,
but that will get rid of the .param file</LI>
<LI>FrameMaker under Solaris2.x uses the lp command. The fix is to edit
$FMHOME/fminit/FMlpr and comment out the lp line and add an lpr line
<BLOCKQUOTE><CODE>
<PRE>
sunxm.s5.sparc)
    lpr -P"$PRINTER" "$FILE"
    #lp -c -d"$PRINTER" "$FILE"
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</OL>

<BLOCKQUOTE><CODE>
<PRE>
Christopher Hylands, Ptolemy Project Manager  University of California
cxh@eecs.berkeley.edu                 US Mail: 558 Cory Hall #1770
ph: (510)643-9841 fax:(510)642-2739       Berkeley, CA 94720-1770
home: (510)526-4010 (if busy -4068)       (Office: 493 Cory)
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss5.3">5.3 Linux</A>
</H2>

<P>At the time of this writing (Jan 1998),
the three major Linux
distributions (Slackware, Red Hat and Debian) carry an older version
of LPRng. Users of those systems should download the
latest stable release, and install that instead of the distributed
binaries.
<P>This is mostly important for Slackware 3.2 users, as this version
installs LPRng by default.
Patrick Volkerding changed the default back to
BSD LPR in Slackware 3.3,
as many users had experienced problems
because they didn't realize they weren't using the BSD software.
<P>Debian's <CODE>dselect</CODE> utility lets you choose between all
packages. Amongst these are LPRng, as well as the traditional LPR
software.
<P>You have to make sure your kernel is configured correctly. The
documentation for the kernel sources in
<CODE>/usr/src/linux/Documentation/</CODE> and the <CODE>Kernel-HOWTO</CODE>
will help you to generate a new kernel if needed. You will need to set
the following options:
<UL>
<LI>Networking support (<CODE>CONFIG_NET</CODE>)</LI>
<LI>TCP/IP support (<CODE>CONFIG_INET</CODE>)</LI>
<LI>If your printer is connected to a parallel port, you will also
need the `Parallel Printer Support' (<CODE>CONFIG_PRINTER</CODE>).
You can use this as a module if you want.</LI>
<LI>For a serial printer, answer `Yes' when asked if you want
`Support for serial devices' (<CODE>CONFIG_SERIAL</CODE>). This is
also available as a module.</LI>
</UL>
<P>Once you have done this,
the current releases of LPRng will install and run without
problems.
See the
<A HREF="LPRng-HOWTO-4.html#installingprograms">Installing the programs</A>
section for details on how to install LPRng and
deactivate the existing print support.
<P>You may need to update the printcap file and filters.
See 
<A HREF="LPRng-HOWTO-8.html#printcapref">Using the Printcap Database</A>
for details.
<H2><A NAME="ss5.4">5.4 AIX</A>
</H2>

<P>This information was supplied by
<A HREF="mailto:nitschke@math.unihamburg.de">Dirk Nitschke</A>,
as of August 1997,
and describes how to install the LPRng package on a workstation
running AIX 4.1.x and possibly 3.x.x as well.
Dirk would be interested in any comments or corrections.
<P>Printing on AIX systems is different. AIX provides a general
queueing facility and printing is only one way to use it. You submit a
print job to a print queue using one of the commands
<CODE>qprt</CODE>, <CODE>enq</CODE>. You can use the BSD or
System V printing commands <CODE>lpr</CODE> or <CODE>lp</CODE>, too. The
qdaemon watches all (general) queues and knows how to handle your
job. A (general) queue is defined in the file
<CODE>/etc/qconfig</CODE>. The format of this file is different from
the <CODE>printcap</CODE> format.
<P>OK, how to replace the AIX printing system? There is no group
<CODE>daemon</CODE> on AIX. Therefore you have to change the default
group for file ownership and process permissions. We decided to use
the <CODE>printq</CODE> group. The user <CODE>daemon</CODE> exists on
AIX but we have chosen <CODE>lpd</CODE> as the user who runs
<CODE>lpd</CODE> and all filters and owns the spooling directories.
You can change the values for <CODE>group</CODE>
and <CODE>user</CODE> in your
<CODE>lpd.conf</CODE> file or in the sources
<CODE>src/common/vars.c</CODE>. This is an example for
<CODE>lpd.conf</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
# Purpose: group to run SUID ROOT programs
#   default group=daemon
group=printq
# Purpose: server user for SUID purposes
#   default user=daemon
user=lpd
</PRE>
</CODE></BLOCKQUOTE>

Compile and install the LPRng package. Create your
<CODE>printcap</CODE>, spooling directories, accounting and logfiles
and so on.
Don't forget to use
<A HREF="LPRng-HOWTO-9.html#checkpc">checkpc</A> to make sure that all the
permissions are set correctly and the necessary files
are created.
<P>Then stop all print queues defined on your workstation. Use
<BLOCKQUOTE><CODE>
<PRE>
# chque -q queuename -a "up = FALSE"
</PRE>
</CODE></BLOCKQUOTE>

for this (yes, blanks around <CODE>=</CODE> are needed).
<P>If you have local printers attached to your system you will have an
<CODE>lpd</CODE> running. Stop this daemon using SMIT (Print Spooling,
Manage Print Server, Stop the Print Server Subsystem). Choosing
<CODE>both</CODE> also removes <CODE>lpd</CODE> from
<CODE>/etc/inittab</CODE>. Maybe it's faster to do this by hand:
<BLOCKQUOTE><CODE>
<PRE>
# stopsrc -p'pid of /usr/sbin/lpd'
# rmitab "lpd"
</PRE>
</CODE></BLOCKQUOTE>
<P>Now delete all print queues (managed by qdaemon) defined on your
system. You can use SMIT for this or the commands
<CODE>{mk,ch,rm}que</CODE>, <CODE>{mk,ch,rm}quedev</CODE>,
<CODE>{mk,ch,rm}virprt</CODE>. The SMIT fast path is <CODE>smit
rmpq</CODE>.
<P>To start the new <CODE>lpd</CODE> at system startup you have to add
an entry to <CODE>/etc/inittab</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
# mkitab "lpd:2:once:/full/path/lpd"
</PRE>
</CODE></BLOCKQUOTE>
<P>Some work has to be done if have have a local printer attached to
your workstation. You have to create a device file like
<CODE>/dev/lp0</CODE>. The SMIT fast path for this is <CODE>smit
mkdev</CODE>. Choose <CODE>Printer/Plotter</CODE> and then
<CODE>Printer/Plotter Devices</CODE>. Now <CODE>Add a
Printer/Plotter</CODE>. To create a parallel
printer device select the following:
<BLOCKQUOTE><CODE>
<PRE>
Plotter type:              opp Other parallel printer
Printer/Plotter Interface: parallel
Parent Adapter:            ppa0 Available
</PRE>
</CODE></BLOCKQUOTE>

Now define the characteristics of the device:
<BLOCKQUOTE><CODE>
<PRE>
Port Number: p
</PRE>
</CODE></BLOCKQUOTE>

(<CODE>p</CODE> is for parallel).
Go to the field
<BLOCKQUOTE><CODE>
<PRE>
Send all characters to printer UNMODIFIED   no
</PRE>
</CODE></BLOCKQUOTE>

and select <CODE>yes</CODE>! We have had a lot of trouble with
<CODE>no</CODE>.  This is very important! Expect erroneous output if
you choose <CODE>no</CODE>. If you have already created a device
file, change the characteristics! SMIT's fast path is <CODE>smit
chdev</CODE>.
<P>Finally remove all AIX printing commands like <CODE>qprt</CODE>,
<CODE>lp</CODE>, <CODE>cancel</CODE>, <CODE>lpr</CODE>,
<CODE>lprm</CODE>. You will find a lot of them in
<CODE>/usr/bin</CODE>. Do not remove <CODE>enq</CODE> and friends if
you want to use the general queueing facility.
<P>Now you can start your new <CODE>lpd</CODE>.
<H2><A NAME="ss5.5">5.5 AppleTalk Support</A>
</H2>

<P>Netatalk is used to communicate from TCP/IP to
AppleTalk printers and vice versa.
The Netatalk distribution FAQ is at:
<P>
<A HREF="http://www.umich.edu/~rsug/netatalk">http://www.umich.edu/~rsug/netatalk</A><P>There are two issues with using netatalk.  The first issue
has to do with printing to LPRng-served printers from Macs.
The second issue has to do with printing from LPRng to
network printers that speak AppleTalk.
<P>
<H2><A NAME="ss5.6">5.6 Apple to LPRng Printing</A>
</H2>

<P>After you have installed and gotten netatalk working,
you can use the following configuration file to print
from a Macintosh to an LPRng printer.
<BLOCKQUOTE><CODE>
<PRE>
Date: Tue, 30 Sep 1997 00:04:58 -0400 (EDT)
From: Edan Idzerda &lt;edan@mtu.edu>
To: lprng@iona.com
Subject: Re: [LPRng] Netatalk configuration file
> Somebody posted a very nice Netatalk papd.conf file
> that showed the setup for LPRng.  If anybody has this
> handy could you post it?
Well, *I* use:
Your 32 Character Printer Name:\
        :pr=|/your/path/to/lpr -Pprintername
        :ppd=/your/path/to/ppd/files/yourprinter.ppd
--
Edan Idzerda    &lt;edan@mtu.edu>
System Administrator -- Michigan Technological University, Houghton MI USA
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss5.7">5.7 LPRng to AppleTalk Printing</A>
</H2>

<P>The netatalk package comes with a PostScript filter called <CODE>psf</CODE>.  After
compilation, it is in (e.g.) <CODE>netatalk-1.4b2/etc/psf</CODE> and will be installed
in (e.g.) <CODE>/usr/local/atalk/etc/</CODE>.  After installation, there will also
be a directory <CODE>/usr/local/atalk/etc/filters</CODE> that contains
<CODE>ifpap</CODE>, <CODE>ofpap</CODE>,
et al.  These are just symlinks to <CODE>psf</CODE>, and <CODE>psf</CODE> will do the appropriate
thing based on how it was invoked.  If there's a 'pap' in the name,
<CODE>psf</CODE> uses AppleTalk to talk to the printer.  See psf(8) for more information.
<P>A printcap entry for a network printer looks like the following:
<BLOCKQUOTE><CODE>
<PRE>
dave|Dave's 32 Character Printer Name
    :sd=/var/spool/lpd/dave
    :if=/usr/local/atalk/etc/filters/ifpap
    :of=/usr/local/atalk/etc/filters/ofpap
    :lp=/var/spool/lpd/dave/null
</PRE>
</CODE></BLOCKQUOTE>
<P>There are three caveats to using netatalk this way.
<OL>
<LI>The first is that
<CODE>psf</CODE> (i.e., the filters) needs to run as root.  You can accomplish this
in one of two ways.  The first requires LPD to run the programs as root: 
<BLOCKQUOTE><CODE>
<PRE>
# ROOT_CFLAG=-DROOT_PERMS_TO_FILTER_SECURITY_LOOPHOLE
</PRE>
</CODE></BLOCKQUOTE>

<P>The filter lines then need to look like the following:
<BLOCKQUOTE><CODE>
<PRE>
    :if=ROOT /usr/local/atalk/etc/filters/ifpap
    :of=ROOT /usr/local/atalk/etc/filters/ofpap
</PRE>
</CODE></BLOCKQUOTE>
<P>The alternative is to make <CODE>psf</CODE> SETUID root.
To minimize the risk,
you may want to make <CODE>psf</CODE> executable only by group <CODE>daemon</CODE>.
(I haven't tested the first option.  I'm currently using the second option.)
<P>
</LI>
<LI>The second caveat is that each network printer needs a <CODE>.paprc</CODE> in its
spool directory.  For instance, <CODE>/var/spool/dave/.paprc</CODE> looks like this:
<BLOCKQUOTE><CODE>
<PRE>
Dave's 32 Character Printer Name:LaserWriter@Your AppleTalk Zone
</PRE>
</CODE></BLOCKQUOTE>

<P>See psf(8) and pap(1) for more information.
<P>
</LI>
<LI>The third caveat concerns the lp line in the printcap entry.  For a
single printer, this can be <CODE>/dev/null</CODE>.  If the host spools to more
than one AppleTalk printer, you shouldn't use <CODE>/dev/null</CODE> for lp.  You
should use <CODE>mknod</CODE> to create a null device for each printer.  See psf(8).</LI>
</OL>

<BLOCKQUOTE><CODE>
<PRE>
Chad Mynhier &lt;mynhier@cs.utk.edu>
Lab Engineer, CS Department        
University of Tennessee, Knoxville                   
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="smb"></A> <A NAME="ss5.8">5.8 SAMBA, SMB and LPRng</A>
</H2>

<P>SMB is the protocol by which a lot of
PC-related machines share files and printers and other information
such as lists of available files and printers. Operating systems that
support this natively include Windows NT, OS/2, and Linux and add on
packages that achieve the same thing are available for DOS, Windows,
VMS, Unix of all kinds, MVS, and more. There is no reason why Apple
Macs and indeed any Web browser should not be able to speak this
protocol, and current development (in which the Samba team is heavily
involved) is aimed at exactly that. Alternatives to SMB include
Netware, NFS, AppleTalk, Banyan Vines, Decnet etc; many of these have
advantages but none are both public specifications and widely
implemented in desktop machines by default.
<P>SAMBA is a package that supports the SMB protocol and provides
a simple and easy way to import and export file systems and printer
facilities.
The web site for SAMBA is
<A HREF="http://www.samba.org">http://www.samba.org</A>.
<P>The SAMBA code is very easy to configure.  See the SAMBA
<CODE>doc/text/Printing.txt</CODE> and related documentation for details.
In the
<CODE>samba.conf</CODE> file
<CODE>[global]</CODE> section you specify the
<CODE>print</CODE>, <CODE>lpq</CODE>, and <CODE>lprm</CODE> commands to be used,
and in the <CODE>[printing]</CODE> section the location
of a temporary directory to hold print jobs when they are submitted.
<BLOCKQUOTE><CODE>
<PRE>
[printers]
    path = /tmp
    guest ok = no
    print ok = yes
    printing = lprng
    load printers = yes 
    printcap name = /etc/printcap
    print command = /usr/local/bin/lpr  -P%p -r %s
    lpq command   = /usr/local/bin/lpq  -P%p
    lprm command  = /usr/local/bin/lprm -P%p %j
    lppause command = lpc hold %p %j
    lpresume command = lpc release %p %j
    queuepause command = lpc -P%p stop
    queueresume command = lpc -P%p start
        #
    # alternative to allow userid to be specified as well
        #
    # You will have to add the samba UID to the 'allow_user_setting'
    #   option in the /etc/lpd.conf file.
    # WARNING: the %U is the name the user requests.  If you have
        # 'guest' printer use,  then you should be aware that this
        # will allow anybody to impersonate a another user,  and they will
        # be able to execute the various LPRng commands as that user.
        #
#   print command = /usr/local/bin/lpr -U%U -P%p -r %s
#   lprm command  = /usr/local/bin/lprm -P%p -U%U %j
#   lppause command = lpc -U%U hold %p %j
#   lpresume command = lpc -U%U release %p %j
#   queuepause command = lpc -U%U -P%p stop
#   queueresume command = lpc -U%U -P%p start
</PRE>
</CODE></BLOCKQUOTE>
<P>The path= value specifies a directory where
the print files are temporarily stored.  This must NOT
be an LPRng printer spool directory,  but some other directory that
Samba has write permissions for.
<P>If you plan to use SAMBA and LPRng,
then you should use the old BSD format for the printcap files,
i.e.- using the <CODE>\</CODE> line continuation indicator.
<H2><A NAME="ss5.9">5.9 Printing to a NetBEUI Printer</A>
</H2>

<P>You can use the SAMBA smprint script to
send a print job to an SMB client.
<BLOCKQUOTE><CODE>
<PRE>
#!/bin/sh -x
# This script is an input filter for printcap printing on a unix machine. It
# uses the smbclient program to print the file to the specified smb-based 
# server and service.
# For example you could have a printcap entry like this
#
# smb:lp=/dev/null:sd=/usr/spool/smb:sh:if=/usr/local/samba/smbprint
#
# which would create a unix printer called "smb" that will print via this 
# script. You will need to create the spool directory /usr/spool/smb with
# appropriate permissions and ownerships for your system.
#
# The /usr/spool/smb/.config file should contain:
#   server=PC_SERVER
#   service=PR_SHARENAME
#   password="password"
#
# Set these to the server and service you wish to print to 
# In this example I have a WfWg PC called "lapland" that has a printer 
# exported called "printer" with no password.
#
# E.g.
#   server=PAULS_PC
#   service=CJET_371
#   password=""
# Should read the following variables set in the config file:
#   server, service, password
config_file=.config
eval `/bin/cat $config_file`
# echo "server $server, service $service" 1>&amp;2
# NOTE You may wish to add the line `echo translate' if you want automatic
# CR/LF translation when printing.
(
#   echo translate
    echo "print -"
    /bin/cat
) | /usr/local/bin/smbclient "\\\\$server\\$service" \
   "$password" -U "$server" -N -P 1>&amp;2
</PRE>
</CODE></BLOCKQUOTE>
<P>If the above script was in <CODE>/usr/local/lib/filters/smbprint</CODE>,
the printcap entry for this printer would be:
<BLOCKQUOTE><CODE>
<PRE>
pauls_pc:
  :sd=/var/spool/lpd/%P
  # we filter the output
  :lp=|/usr/local/lib/filters/smbprint
  # you can add filters if you want to do specific actions
  :ifhp=model=hp4
  if=/usr/local/lib/filters/ifhp
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="printspec"></A> <A NAME="ss5.10">5.10 Printer Specific notes</A>
</H2>

<P>This is a small collection of miscellaneous notes about printers
and applications.
<H2><A NAME="ss5.11">5.11 HP Deskjet</A>
</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
From: jarausch@igpm.rwth-aachen.de (Helmut Jarausch)
Subject: Re: Using gs (GhostScript) as a filter? 
To: lprng@iona.com
Cc: Rick Gaine &lt;rgaine@nbcs.rutgers.edu>
Sender: majordomo-owner@iona.com
Reply-To: lprng@iona.com
>> 
>> Hello All:
>> 
>> I would like to use LPRng 3.1.4 with an HP LaserJet 4P.  I'd like to be
>> able to use gs to convert PostScript files so that I can print them on my
>> HP 4P.  Can I do this with LPRng?  If so, could someone send me a printcap
>> entry?  I'd appreciate it.  I am not sure how I will be connecting the
>> printer yet, but I am thinking either serial or network.  Probably serial
>> though.  Thanks for any help.
</PRE>
</CODE></BLOCKQUOTE>
<P>This printcap works for my Deskjet:
<BLOCKQUOTE><CODE>
<PRE>
djps
    :cm=Local Deskjet(GhostScript)
    :sd=/var/spool/djps:sf:sh:mx=0
    :lp=/dev/plp
    :if=/usr/local/bin/LPRng/ps_to_deskjet:
</PRE>
</CODE></BLOCKQUOTE>
<P>and this is the script /usr/local/bin/LPRng/ps_to_deskjet
<BLOCKQUOTE><CODE>
<PRE>
#!/bin/sh
nice -19 /usr/local/bin/gs -sDEVICE=cdj550 -sPAPERSIZE=a4 \
    -sOutputFile=- -q -r300 - 
</PRE>
</CODE></BLOCKQUOTE>

<BLOCKQUOTE><CODE>
<PRE>
Helmut Jarausch
Lehrstuhl f. Numerische Mathematik
Institute of Technology
RWTH Aachen
D 52056 Aachen, Germany
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss5.12">5.12 HP LaserJet IIISiMX</A>
</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
> From majordomo-owner@iona.com Mon Aug 31 11:17:26 1998
> To: lprng@lprng.org
> Subject: [LPRng] problems printing PS-level2 jobs on LjIIsi's...
> Date: Mon, 31 Aug 1998 15:06:22 -0400
> From: "John Saroglou" &lt;johny@yorku.ca>
>
> Greetings...
>
> I'm wondering if someone got around the problem of printing
> Postscript(R) Level 2  jobs on Laser Jet IIIsi printers.
> Our printers are direct network printers talking to a
> print server running solaris 2.6 and lprng-3.5.1.
>
> Is there a fix (possible drivers?) for such problem?
>
> Thanks in advance.
</PRE>
</CODE></BLOCKQUOTE>
<P>The LaserJet IIISi does not support PostScript level 2, only level 1
(really, it is called 3SiMX).
The Windows (you are under Windows, right?) HP driver for 3Si/3Si MX
PostScript should produce only PS level 1.
<P>Beware: latest version of Adobe Windows PS driver produces *ONLY* PS
level 2.
So if you have (or receive) level 2 files, read them using GhostScript
and print a screen dump :-) or as a bitmap. 
<P>You can also convert them into PDF (using either Adobe distiller or
GhostScript's ps2pdf) then use <I>acroread</I> to print the result.
<I>Acroread</I> can
produce either level 1 or level 2 PostScript. THE definite solution!
<P>This trouble has nothing to do with the way they are connected,
it is only a driver problem.
I believe that HP had once a PS level2 update, but the price was so high
that buying a new printer was a better solution!
<BLOCKQUOTE><CODE>
<PRE>
Bertrand
-- 
| Bertrand DECOUTY              | mailto:Bertrand.Decouty@irisa.fr   |
| IRISA - INRIA (Atelier)       | PHONE : 0299847346 / 0299847100    |
| Campus de Beaulieu            | FAX   : +33 (0) 299842534          |
| F-35042 Rennes Cedex - FRANCE | http://www.irisa.fr/               |
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss5.13">5.13 HP JetDirect Interface</A>
</H2>

<P>The  HPJetDirect  card  can  be configured through the front
panel  or through a set of network files.  Here is a summary
of  the  methods  used  from  UNIX  systems, or when you are
desperate, to configure the printer.
<H3>Setting Up IP Networking and Address</H3>

<P>You can set the network address from the front panel.
Reset  the printer,
put it in offline mode.
and then use the MENU, +-, SELECT keys as follows:
<BLOCKQUOTE><CODE>
<PRE>
 MENU  -> MIO MENU (use MENU to display MIO MENU)
 ITEM  -> CFG NETWORK=NO*
 +     -> CFG NETWORK=YES
 ENTER -> CFG NETWORK=YES*
 ITEM  -> TCP/IP=OFF* (use ITEM to display TCP/IP)
 +     -> TCP/IP=ON
 ENTER -> TCP/IP=ON*
 ITEM  -> CFG TCP/IP=NO* (use ITEM to display TCP/IP)
 +     -> CFG TCP/IP=YES
 ENTER -> CFG TCP/IP=YES*
 ITEM  -> BOOTP=NO*
     (Enable BOOTP if you want to - see below)
 ITEM  -> IP BYTE 1=0*
     This is IP address MSB byte.
     Use +- keys to change value, and then ENTER to change
     Use ITEM keys to get IP BYTE=2,3,4
 ITEM  -> SM BYTE 1=255*
      This is the subnet mask value
     Use +- keys to change value, and then ENTER to change
     Use ITEM keys to get IP BYTE=2,3,4
 ITEM  -> LG BYTE 1=255*
     This is the Syslog server (LoGger) IP address
     Use +- keys to change value, and then ENTER to change
     Use ITEM keys to get IP BYTE=2,3,4
 ITEM  -> GW BYTE 1=255*
     This is the subnet gateway (router) IP address
     Use +- keys to change value, and then ENTER to change
     Use ITEM keys to get IP BYTE=2,3,4
 ITEM  -> TIMEOUT=90
      This is the connection timeout value.  It puts a limit
     on time between connections.  A value of 10 is reasonable.
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H3>BOOTP Information</H3>

<P>If  you have a bootp server, you can put this information
in  the  bootptab  file.   To  use this, you must enable the
bootp  option  on  the printer.  The T144 option specifies a
file to be read from the bootp server.  This file is read by
using  the  TFTP  protocol, and you must have a TFTPD server
enabled.  Here is a sample bootptab entry.
<BLOCKQUOTE><CODE>
<PRE>
# Example /etc/bootptab: database for bootp server (/etc/bootpd).
# Blank lines and lines beginning with '#' are ignored.
#
# Legend:
#
#       first field -- hostname
#                       (may be full domain name)
#
#       hd -- home directory
#       bf -- bootfile
#       cs -- cookie servers
#       ds -- domain name servers
#       gw -- gateways
#       ha -- hardware address
#       ht -- hardware type
#       im -- impress servers
#       ip -- host IP address
#       lg -- log servers
#       lp -- LPR servers
#       ns -- IEN-116 name servers
#       rl -- resource location protocol servers
#       sm -- subnet mask
#       tc -- template host (points to similar host entry)
#       to -- time offset (seconds)
#       ts -- time servers
#
# Be careful about including backslashes where they're needed.  Weird (bad)
# things can happen when a backslash is omitted where one is intended.
#
peripheral1:
:hn:ht=ether:vm=rfc1048:
:ha=08000903212F:
:ip=190.40.101.22:
:sm=255.255.255.0:
:gw=190.40.101.1:
:lg=190.40.101.3:
:T144="hpnp/peripheral1.cfg":
</PRE>
</CODE></BLOCKQUOTE>
<P>If  you  are  using the T144 option, you will need to create
the  configuration file.  The sample configuration file from
the HP Direct distribution is included below.
<BLOCKQUOTE><CODE>
<PRE>
#
# Example HP Network Peripheral Interface configuration file
#
# Comments begin with '#' and end at the end of the line.
# Blank lines are ignored.  Entries cannot span lines.

# Name is the peripheral (or node) name.  It is displayed on the peripheral's
# self-test page or configuration plot, and when sysName is obtained through
# SNMP.  This name can be provided in the BOOTP response or can be specified
# in the NPI configuration file to prevent the BOOTP response from overflowing
# the packet.  The domain portion of the name is not necessary because the
# peripheral does not perform Domain Name System (DNS) searches.  Name is
# limited to 64 characters.

name: picasso

# Location describes the physical location of the peripheral.  This is the
# value used by the interface for the MIB-II sysLocation object.  The default
# location is undefined.  Only printable ASCII characters are allowed.
# Maximum length is 64 characters.

location: 1st floor, south wall

# Contact is the name of the person who administers or services the peripheral
# and may include how to contact this person.  It is limited to 64 characters.
# This is the value used by the interface for the MIB-II sysContact object.
# The default contact is undefined.  Only printable ASCII characters are
# allowed.  Maximum length is 64 characters.

contact: Phil, ext 1234

# The host access list contains the list of hosts or networks of hosts
# that are allowed to connect to the peripheral.  The format is
# "allow: netnum [mask]", where netnum is a network number or a host IP
# address.  Mask is an address mask of bits to apply to the network number
# and connecting host's IP address to verify access to the peripheral.
# The mask usually matches the network or subnet mask, but this is not
# required.  If netnum is a host IP address, the mask 255.255.255.255 can
# be omitted.  Up to ten access list entries are permitted.

# to allow all of network 10 to access the peripheral:
allow: 10.0.0.0  255.0.0.0

# to allow a single host without specifying the mask:
allow: 15.1.2.3

# Idle timeout is the time (in seconds) after which an idle
# print data connection is closed.  A value of zero disables
# the timeout mechanism.  The default timeout is 90 seconds.

idle-timeout: 120

# A community name is a password that allows SNMP access to MIB values on
# the network peripheral.  Community names are not highly secure; they are
# not encrypted across the network.  The get community name determines which
# SNMP GetRequests are responded to.  By default, the network peripheral
# responds to all GetRequests.  The get community name is limited to 32
# characters.
#
# For hpnpstat and hpnpadmin, the community name can be stored in
# /usr/lib/hpnp/hpnpsnmp.

get-community-name: blue

# The set community name is similar to the get community name.  The set
# community name determines which SNMP SetRequests are responded to.  In
# addition, SetRequests are only honored if the sending host is on the
# host access list.  By default, the network peripheral does not respond
# to any SetRequests.  The set community name is limited to 32 characters.
#
# The set community name can come from /usr/lib/hpnp/hpnpsnmp
# if it is the same as the get community name.  We recommend that the
# set community name be different from the get community name though.

set-community-name: yellow

# SNMP traps are asynchronous notifications of some event that has occurred.
# SNMP traps are useful only with network management software.  Traps are
# sent to specific hosts and include a trap community name.  Up to four
# hosts can be sent SNMP traps.   The trap community name is limited to
# 32 characters.  The default name is public.

trap-community-name: red

# The SNMP trap destination list specifies systems to which SNMP
# traps are sent.  Up to four IP addresses are allowed.  If no
# trap destinations are listed, traps are not sent.

trap-dest: 15.1.2.3
trap-dest: 15.2.3.4

# The SNMP authentication trap parameter enables or disables the sending
# of SNMP authentication traps.  Authentication traps indicate that an SNMP
# request was received and the community name check failed.  By default,
# the parameter is off.

authentication-trap: on

# The syslog-facility parameter sets the source facility identifier that the
# card uses when issuing syslog messages.  Other facilities, for example,
# include the kernel (LOG_KERN), the mail system (LOG_MAIL), and the spooling
# system (LOG_LPR).  The card only allows its syslog facility to be configured
# to one of the local user values (LOG_LOCAL0 through LOG_LOCAL7).  The
# selectible option strings, local0 through local7 (configured to LOG_LOCAL0
# through LOG_LOCAL7, respectively) are case insensitive.  The default
# syslog-facility for the card is LOG_LPR.

syslog-facility: local2

# This parameter allows the card to treat hosts on other subnets as if the
# hosts were on the card's subnet.  This parameter determines the TCP
# Maximum Segment Size (MSS) advertised by the card to hosts on other subnets
# and affects the card's initial receive-window size.  The card will use a
# TCP MSS of 1460 bytes for local hosts, and 536 bytes for a non-local host.
# The default is off, that is, the card will use the maximum packet sizes
# only on the card's configured subnet.
#
# The configuration utility does not allow access to this parameter.  If you
# want to configure it, you must manually edit the NPI configuration file
# and add it to the bottom of the entry for the network peripheral.

subnets-local: on

# This parameter affects how the card handles TCP connection requests from
# the host.  By default, the JetDirect MPS card will accept a TCP connection
# even if the peripheral is off-line.  If this parameter is set to "on", then
# the card will only accept a TCP connection when the peripheral is on-line.

old-idle-mode: off
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H3>Paper Tray Selection</H3>

<P>Be careful with your paper tray selection.  You should configure the
printer,  using the front panel switches,  to select the FIRST paper
tray.  See your printer documentation on this.  Unfortunately,  different
models of HP printers have different methods of handling paper trays.
<H2><A NAME="ss5.14">5.14 Lexmark Printers</A>
</H2>

<P>Some Lexmark printers do not send
<EM>end of job</EM> status back unless configured
to do so.
Here is what is needed to force this.
<BLOCKQUOTE><CODE>
<PRE>
Date: Wed, 21 Jan 1998 18:25:50 -0600 (CST)
From: Matt White &lt;whitem@bofh.usask.ca>
To: lprng@iona.com
Subject: Re: [LPRng] ifhp with Lexmark Optra N printer

On Wed, 21 Jan 1998, Simon Greaves wrote:

> Apologies in advance if this is way off mark, but we've been evaluating a
> commercial print charging package (Geomica) which works by talking to the
> printer in what I think is a similar way to the ifhp filters. Lexmarks are
> currently a big headache because they seem to fail to return the message
> that they have finished printing which screws things up somewhat. In our
> case, it is believed to be a problem with the Lexmark firmware which they
> are looking into. 

There is a fix for that...it is originally from the Lexmark 4039 series,
but it still works on the Optra S 1650 machines that we have (and should
work on the rest of the optra line).  Just send this little chunk of
postscript to the printer once:

-----------snip----------
%! Postscript utility file to set the 4039 printer into synchronous mode
serverdict begin 0 exitserver
statusdict begin true setenginesync end
-----------snip----------

Basically, it causes the printer to wait until it is finished printing
before actually reporting that it is done.  I've got 3 Optra S printers
running with ifhp right now with no extra options (just defaults).
 
---------------------------------------------------------------------
- Matt White                         whitem@arts.usask.ca           -
- Network Technical Support          http://arts.usask.ca/~whitem   -
- College of Arts &amp; Science          University of Saskatchewan     -
---------------------------------------------------------------------
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="P450"></A> <A NAME="ss5.15">5.15 Network Base Tektronix Phaser Printers</A>
</H2>

<P>The <CODE>ifhp</CODE> filter supports the
<A HREF="LPRng-HOWTO-3.html#appsocket">APPsocket</A> protocol used by Tektronix.
You will need a printcap similar to the following:
<BLOCKQUOTE><CODE>
<PRE>
phaser:
 :sd=/var/spool/lpd/%P
 # need a dummy device for output
 :lp=/dev/null
 # You need to specify the IP address of the printer's network interface
 #  In this example it is 10.0.0.1 - replace with the correct value
 # The filter will actually open the connection.
 :if=/usr/local/lib/filter/ifhp -Tdev=10.0.0.1%9100,model=tek
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss5.16">5.16 Duplex Printing</A>
</H2>

<P>Duplex printing is when you print on both sides of a page.
Some printers which do duplex printing require that you
send them special commands to force this mode.  This is
usually done by the FILTERS.  The IFHP filter makes a stab at sending
the PJL or PostScript commands to the printer.  Many people have
reported problems doing duplex printing,  so  here is a check
list.
<OL>
<LI>Make sure you have enough memory for the worst case
print job.  Usually the printer has to rasterize both
pages before it can produce an impression.  It may require
much more memory than you expect.</LI>
<LI>Check your printer manual to discover the EXACT form of the
<CODE>enter duplex mode</CODE> command and make sure that either the command
is part of the job (PJL language at the start of the job,
postscript header, etc), or that the filter generates the
correct form.
<P>Note there is a PostScript Printer Description file (PPD) for
most printers that support PostScript,  and they even have the
PJL and PostScript code for this in the PPD file.
</LI>
<LI>It has been observed that even with what would apparently be
sufficient memory,  that many duplex jobs print 'oddly',
that they are not aligned on the same side in the same way,
etc etc.  This may not be the fault of the software,  but of the
support for duplex operation.</LI>
<LI>Read the IFHP documentation,
and create a configuration section in the <CODE>ifhp.conf</CODE> file
for your printer.</LI>
</OL>
<P>I know this is painful,  but until there is a uniform way to get the
correct commands extracted from either PPD or some other database then
this appears to be the only way to do it.
<BLOCKQUOTE>
<EM>Patrick Powell</EM>
</BLOCKQUOTE>
<H2><A NAME="ss5.17">5.17 Test Version  and Portability Testing</A>
</H2>

<P>The LPRng code has the ability to run as non-setuid software,
and to use the non-default TCP/IP ports for communication.
This facility allows a <EM>Test Version</EM> to be run in parallel with the
normal LPRng software.
<P>To simplify testing and portability issues,
a simple test version of the spool queues and jobs has been supplied with the
LPRng distribution.
These queues can be placed in a suitable location
(<CODE>/tmp</CODE> is common) and the LPRng software tested.
<P>The test version of the software will use the <CODE>LPD_CONF</CODE>
environment variable to specify the location of the configuration file.
It will read this configuration file on startup and use the values
to override the normal defaults.
Since a user could maliciously set up their own configuration files
with values that could compromise system security,
it is strongly recommended that the test version is not made SETUID root.
In fact,
the LPRng code will chatter messages when the LPD_CONF ability is enabled
and it is run as root.
<H3>Compiling the Test Version</H3>

<P>Edit <CODE>src/Makefile</CODE>, and uncomment the indicated line.
Then run <CODE>make</CODE> to regenerate the distribution.
<BLOCKQUOTE><CODE>
<PRE>
#### ****** TESTING AND SECURITY LOOPHOLE ******************************
# Define GETENV to allow the LPD_CONFIG environment
#  variable to be used as the name of a configuration file.  In non-testing
#  systems,  this is a security loophole.
#CF := $(CF) -DGETENV
</PRE>
</CODE></BLOCKQUOTE>
<H3>Setting Up The Test Version Spool Queues</H3>

<P>The LPRng <CODE>TESTSUPPORT</CODE> directory contains a set of shell scripts
and files that need to be installed in the appropriate directory.
The following steps are used.
<OL>
<LI>First,
you need to set up your <CODE>HOST</CODE> environment variable to the fully
qualified domain name of your host
and your <CODE>USER</CODE> environment variable to your user name.
This is done in order to get values to put into the Test Version configuration files.</LI>
<LI>In the <CODE>TESTSUPPORT</CODE> directory,
edit the <CODE>Makefile</CODE>,
and specify the location of the <CODE>Test Version</CODE> spool queues.
The default location is <CODE>/tmp</CODE>;
since on most systems these files are deleted or are available to everybody,
a more secure location should most likely be used.
<B>DO NOT USE THE RAW TESTFILE DIRECTORY</B>.
These files need to be copied and placed in another directory.</LI>
<LI>The <CODE>LPD_CONF</CODE> environment variable should be set to the
location of the installed <CODE>lpd.conf</CODE> file.</LI>
<LI>In the <CODE>TESTSUPPORT</CODE> directory,
run <CODE>make</CODE>.
This will copy and install the necessary files.</LI>
</OL>
<P>Example:
<BLOCKQUOTE><CODE>
<PRE>
  CSH:
    setenv HOST {fully qualified domain name};
    setenv USER `whoami`
    setenv LPD_CONF /tmp/LPD/lpd.conf
    set path=( /tmp/LPD $path )
    unsetenv PRINTER
   Example:
      setenv HOST astart1.astart.com
      setenv USER papowell
      setenv LPD_CONF /tmp/LPD/lpd.conf
      set path=( /tmp/LPD $path )
      unsetenv PRINTER
  Bourne Shell:
    HOST={fully qualified domain name}; export HOST;
    USER='whoami'; export USER
    LPD_CONF=/tmp/LPD/lpd.conf.$HOST; export LPD_CONF
    PATH=/tmp/LPD:$PATH; export PATH
    PRINTER=; export PRINTER
   Example: 
      HOST=astart1.astart.com; export HOST
      USER=papowell; export USER
      LPD_CONF=/tmp/LPD/lpd.conf.$HOST; export LPD_CONF
      PATH=/tmp/LPD:$PATH; export PATH
      PRINTER=; export PRINTER
  cd TESTSUPPORT
  make
</PRE>
</CODE></BLOCKQUOTE>
<H3>Running the Test Version Software</H3>

<P>Set your current directory to the location of the compiled <CODE>Test Version</CODE>
executables.
Execute the various executables using <CODE>./cmd</CODE>,
or set <CODE>.</CODE> <B> as the first entry in the PATH </B>.
If it is not the first entry,
then the standard system executables will be used.
<OL>
<LI> Run <CODE>./checkpc</CODE>.
this will print out the various values for the spool queues in the <CODE>Test Version</CODE>
setup.
If the <CODE>t1</CODE>, <CODE>t2</CODE>,... spool queues are not displayed,
make sure that the LPD_CONF environment variable is set correctly and that you
are using the <CODE>Test Version</CODE> executable.</LI>
<LI>Run <CODE>./checkpc -f</CODE>.
This will fix up the (deliberately introduced) problems in the spool queues.</LI>
<LI>Next,  run <CODE>./lpd -F</CODE> in one window,
and then run <CODE>./lpq -a </CODE> in another window.
This will check that the server is working.</LI>
<LI>You can now amuse yourself by sending jobs,
setting up permissions checking,
and other chores.</LI>
<LI>When everything appears to be working correctly,
you can then remove the <CODE>Test Version</CODE> flag from the
<CODE>src/Makefile</CODE>, recompile,
and install the LPRng software.</LI>
</OL>
<HR>
<A HREF="LPRng-HOWTO-6.html">Next</A>
<A HREF="LPRng-HOWTO-4.html">Previous</A>
<A HREF="LPRng-HOWTO.html#toc5">Contents</A>
</BODY>
</HTML>
