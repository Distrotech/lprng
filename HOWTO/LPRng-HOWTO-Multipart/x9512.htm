<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="generator" content="HTML Tidy, see www.w3.org">
    <title>Reliable Accounting</title>
    <meta name="GENERATOR" content=
    "Modular DocBook HTML Stylesheet Version 1.71 ">
    <link rel="HOME" title=" LPRng-HOWTO" href="index.htm">
    <link rel="UP" title="Accounting " href="accountingref.htm">
    <link rel="PREVIOUS" title=
    "Accessing Printer Hardware Pagecounters" href="x9501.htm">
    <link rel="NEXT" title="\LPRng accounting.pl Utility" href=
    "x9527.htm">
  </head>

  <body class="SECT1" bgcolor="#FFFFFF" text="#000000" link=
  "#0000FF" vlink="#840084" alink="#0000FF">
    <div class="NAVHEADER">
      <table summary="Header navigation table" width="100%" border=
      "0" cellpadding="0" cellspacing="0">
        <tr>
          <th colspan="3" align="center">LPRng-HOWTO: 29 Sep 2001
          (For LPRng-3.7.8)</th>
        </tr>

        <tr>
          <td width="10%" align="left" valign="bottom"><a href=
          "x9501.htm" accesskey="P">Prev</a></td>

          <td width="80%" align="center" valign="bottom">Chapter
          18. Accounting</td>

          <td width="10%" align="right" valign="bottom"><a href=
          "x9527.htm" accesskey="N">Next</a></td>
        </tr>
      </table>
      <hr align="LEFT" width="100%">
    </div>

    <div class="SECT1">
      <h1 class="SECT1"><a name="AEN9512">18.6. Reliable
      Accounting</a></h1>

      <p>In order to do reliable accounting, the printer must be
      queueried for the current value of the pagecounter at the
      start and end of jobs and this information stored in the
      accounting file. The <b class="APPLICATION">ifhp</b> filter
      can be configured to obtain the pagecounter values and to
      record them at the start and end of each part of a print job.
      We can use the <tt class="LITERAL">:of</tt> filter to read
      the pagecounter value at the start and end of a job, and have
      the other file files record information as well. The <tt
      class="LITERAL">ifhp</tt> filter will record the pagecounter
      information with the <tt class="LITERAL">-q</tt> option. We
      need simply take the difference of the starting and ending
      pagecounter values to find the number of pages used by a
      job.</p>

      <div class="INFORMALEXAMPLE">
        <a name="AEN9519"></a>
<pre class="SCREEN">
    start '-p100' '-q20001' '-Fo' '-kcfA100taco' '-uuser' '-hhost' '-R...
    filestart '-p101' '-q20001' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    fileend '-p1' '-q20002' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    filestart '-p102' '-q20002' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    fileend '-p3' '-q20005' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    end '-p5' '-q20005' '-Fo' '-kcfA100taco' '-uuser' '-hhost' '-R...
</pre>
      </div>
      <br>
      <br>

      <p>If for some reason the job is killed or terminates due to
      error conditions, the <tt class="LITERAL">:of</tt> filter may
      not get to record the ending value for the job. This can lead
      to accounting files with the following entries:</p>

      <div class="INFORMALEXAMPLE">
        <a name="AEN9523"></a>
<pre class="SCREEN">
    start '-p100' '-q20005' '-Fo' '-kcfA100taco' '-uuser' '-hhost' '-R...
    filestart '-p101' '-q20005' '-Ff' '-kcfA100taco' '-uuser' '-hhost' '-R...
    start '-p110' '-q20005' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
    filestart '-p112' '-q20010' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
    end '-p112' '-q20010' '-Fo' '-kcfA101taco' '-uuser' '-hhost' '-R...
</pre>
      </div>
      <br>
      <br>

      <p>The missing <tt class="LITERAL">end</tt> is a clear
      indication that the user's job has been terminated. We simply
      use the pagecounter value determined at the start of the next
      job to find the numbers of pages used for this job.</p>
    </div>

    <div class="NAVFOOTER">
      <hr align="LEFT" width="100%">

      <table summary="Footer navigation table" width="100%" border=
      "0" cellpadding="0" cellspacing="0">
        <tr>
          <td width="33%" align="left" valign="top"><a href=
          "x9501.htm" accesskey="P">Prev</a></td>

          <td width="34%" align="center" valign="top"><a href=
          "index.htm" accesskey="H">Home</a></td>

          <td width="33%" align="right" valign="top"><a href=
          "x9527.htm" accesskey="N">Next</a></td>
        </tr>

        <tr>
          <td width="33%" align="left" valign="top">Accessing
          Printer Hardware Pagecounters</td>

          <td width="34%" align="center" valign="top"><a href=
          "accountingref.htm" accesskey="U">Up</a></td>

          <td width="33%" align="right" valign="top">\<b class=
          "APPLICATION">LPRng</b> accounting.pl Utility</td>
        </tr>
      </table>
    </div>
  </body>
</html>

