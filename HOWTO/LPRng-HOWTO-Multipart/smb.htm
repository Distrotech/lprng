<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta name="generator" content="HTML Tidy, see www.w3.org">
    <title>SAMBA and LPRng</title>
    <meta name="GENERATOR" content=
    "Modular DocBook HTML Stylesheet Version 1.71 ">
    <link rel="HOME" title=" LPRng-HOWTO" href="index.htm">
    <link rel="UP" title="Installation" href="installation.htm">
    <link rel="PREVIOUS" title=
    "Emulation for UNIX SystemV lp and lpstat " href=
    "lpsimulation.htm">
    <link rel="NEXT" title="Security Concerns " href="setuid.htm">
  </head>

  <body class="SECT1" bgcolor="#FFFFFF" text="#000000" link=
  "#0000FF" vlink="#840084" alink="#0000FF">
    <div class="NAVHEADER">
      <table summary="Header navigation table" width="100%" border=
      "0" cellpadding="0" cellspacing="0">
        <tr>
          <th colspan="3" align="center">LPRng-HOWTO: 1 Apr 2002
          (For LPRng-3.8.10)</th>
        </tr>

        <tr>
          <td width="10%" align="left" valign="bottom"><a href=
          "lpsimulation.htm" accesskey="P">Prev</a></td>

          <td width="80%" align="center" valign="bottom">Chapter 2.
          Installation</td>

          <td width="10%" align="right" valign="bottom"><a href=
          "setuid.htm" accesskey="N">Next</a></td>
        </tr>
      </table>
      <hr align="LEFT" width="100%">
    </div>

    <div class="SECT1">
      <h1 class="SECT1"><a name="SMB">2.12. SAMBA and <b class=
      "APPLICATION">LPRng</b></a></h1>

      <p>The SMB network protocol is used by many Microsoft
      Operating Systems to implement file and printer sharing.
      SAMBA is a UNIX package that implements the SMB protocol and
      provides a simple and easy way to import and export file
      systems and printer facilities. The web site for SAMBA is <a
      href="http://www.samba.org" target=
      "_top">http://www.samba.org</a>. The SAMBA code is extremely
      easy to install and the <span class="ACRONYM">SWAT</span>
      (Samba Web Administration Tool) makes configuration almost
      trivial.</p>

      <p>The See the SAMBA <tt class=
      "FILENAME">doc/text/Printing.txt</tt> and related
      documentation for details on printing. In the <tt class=
      "FILENAME">samba.conf</tt> file <tt class=
      "LITERAL">[global]</tt> section or in the SWAT page for
      printing configuration you need to specify the that you want
      to have Samba handle printing, the <tt class=
      "LITERAL">print</tt>, <b class="APPLICATION">lpq</b>, and <b
      class="APPLICATION">lprm</b> commands to be used when a user
      prints a job, asks for status, or removes a job, and a
      temporary directory to hold print jobs when they are
      submitted. The following is a simple example of to set up
      printing for authenticated users.</p>

      <div class="INFORMALEXAMPLE">
        <a name="AEN1343"></a>
<pre class="SCREEN">
    [printers]
        path = /var/spool/lpd/samba
        #  ---  do not use the Samba default path = /tmp
        print ok = yes
        printing = lprng
        load printers = yes
        guest ok = no
        printcap name = /etc/printcap
        print command =      /usr/bin/lpr  -P%p -r %s
        lpq command   =      /usr/bin/lpq  -P%p
        lprm command  =      /usr/bin/lprm -P%p %j
        lppause command =    /usr/sbin/lpc hold %p %j
        lpresume command =   /usr/sbin/lpc release %p %j
        queuepause command = /usr/sbin/lpc  -P%p stop
        queueresume command = /usr/sbin/lpc -P%p start
</pre>
      </div>
      <br>
      <br>

      <ol type="1">
        <li>
          <p>Samba will make a copy of the files to be printed in
          the directory specified by <tt class="LITERAL">path</tt>.
          If the print operation fails then sometimes the print
          file is left in the directory.</p>
        </li>

        <li>
          <p>The directory should have the same ownership and
          permissions as <tt class="FILENAME">/tmp</tt>, i.e.-
          owner and group <tt class="LITERAL">root</tt> and <tt
          class="LITERAL">bin</tt>, with <tt class=
          "LITERAL">01777</tt> permissions, where <tt class=
          "LITERAL">01000</tt> is the sticky bit.</p>

          <p>A directory whose `sticky bit' is set becomes an
          append-only directory, or, more accurately, a directory
          in which the deletion of files is re- stricted. A file in
          a sticky directory may only be removed or renamed by a
          user if the user has write permission for the directory
          and the user is the owner of the file, the owner of the
          directory, or the super-user. This feature is usefully
          applied to directories such as /tmp which must be
          publicly writable but should deny users the license to
          arbitrarily delete or rename each others' files.</p>
        </li>

        <li>
          <p>The directory should be examined periodically and
          files older then a day should be removed. The following
          command can be used to do this, and should be put in a
          file that is periodically (one a day) executed by the <b
          class="APPLICATION">cron</b> facility:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1360"></a>
<pre class="SCREEN">
    find /var/spool/lpd/samba -type f -mtime 2d -exec rm -f {} \;
</pre>
          </div>
          <br>
          <br>
        </li>

        <li>
          <p>You must specify the print method as <tt class=
          "LITERAL">printing = lprng</tt>. This will allow Samba to
          parse the <b class="APPLICATION">LPRng</b> <b class=
          "APPLICATION">lpq</b> status format correctly.</p>
        </li>

        <li>
          <p>You must put all of the printers which Samba has
          access to in the <tt class="FILENAME">printcap</tt> file.
          Your Samba server may support reading the printcap file
          by using a program. In this case the printcap file entry
          can be one of the following:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1370"></a>
<pre class="SCREEN">
    [printers]
      #
        printcap name = |/usr/local/libexec/filters/getpc
      # or
        printcap name = |/usr/bin/lpc client all 
    
    #!/bin/sh
    # getpc program
    /usr/bin/lpq -as | /bin/sed -e 's/[@:].*//p'
   
</pre>
          </div>
          <br>
          <br>

          <p>The <tt class="LITERAL">lpc client all</tt> command
          will generate the printcap entries for all of the
          printers. This was done to support Samba and other
          printer gateway systems. You can also use a simple script
          to modify the output of the printer status command as
          shown in the example.</p>
        </li>

        <li>
          <p>Samba can be configured to allow guests or
          non-authenticated users to spool print jobs.
          Unfortunately, by default <b class="APPLICATION">lpr</b>
          will mark the jobs as submitted by the Samba server, not
          the remote users. To solve this problem, the <tt class=
          "COMMAND">lpr -U%U@%M</tt> option causes <b class=
          "APPLICATION">lpr</b> to mark the jobs as submitted by
          user <tt class="LITERAL">%U</tt> on host <tt class=
          "LITERAL">%M</tt>, instead of the Samba server process.
          The use of this option is restricted to root and a set of
          userids listed in the <a href=
          "allowusersetting.htm">allow_user_setting</a>
          configuration option. If the userid of the submitter is
          not in this list, then the option is quietly ignored. The
          <tt class="COMMAND">-U%U@M</tt> can also be used with the
          other LPRng commands as well. For example:</p>

          <div class="INFORMALEXAMPLE">
            <a name="AEN1383"></a>
<pre class="SCREEN">
    [printers]
        guest ok = yes
        print command =       /usr/bin/lpr  -U%U@%M -P%p -r %s
        lpq command   =       /usr/bin/lpq  -U%U@%M -P%p
        lprm command  =       /usr/bin/lprm -U%U@%M -P%p %j
        lppause command =     /usr/sbin/lpc -U%U@%M hold %p %j
        lpresume command =    /usr/sbin/lpc -U%U@%M release %p %j
        queuepause command =  /usr/sbin/lpc -U%U@%M -P%p stop
        queueresume command = /usr/sbin/lpc -U%U@%M -P%p start
</pre>
          </div>
          <br>
          <br>
        </li>
      </ol>
    </div>

    <div class="NAVFOOTER">
      <hr align="LEFT" width="100%">

      <table summary="Footer navigation table" width="100%" border=
      "0" cellpadding="0" cellspacing="0">
        <tr>
          <td width="33%" align="left" valign="top"><a href=
          "lpsimulation.htm" accesskey="P">Prev</a></td>

          <td width="34%" align="center" valign="top"><a href=
          "index.htm" accesskey="H">Home</a></td>

          <td width="33%" align="right" valign="top"><a href=
          "setuid.htm" accesskey="N">Next</a></td>
        </tr>

        <tr>
          <td width="33%" align="left" valign="top">Emulation for
          UNIX SystemV <b class="APPLICATION">lp</b> and <b class=
          "APPLICATION">lpstat</b></td>

          <td width="34%" align="center" valign="top"><a href=
          "installation.htm" accesskey="U">Up</a></td>

          <td width="33%" align="right" valign="top">Security
          Concerns</td>
        </tr>
      </table>
    </div>
  </body>
</html>

