<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> LPRng-HOWTO: Configuration File lpd.conf and Options</TITLE>
 <LINK HREF="LPRng-HOWTO-12.html" REL=next>
 <LINK HREF="LPRng-HOWTO-10.html" REL=previous>
 <LINK HREF="LPRng-HOWTO.html#toc11" REL=contents>
</HEAD>
<BODY>
<A HREF="LPRng-HOWTO-12.html">Next</A>
<A HREF="LPRng-HOWTO-10.html">Previous</A>
<A HREF="LPRng-HOWTO.html#toc11">Contents</A>
<HR>
<H2><A NAME="lpdconf"></A> <A NAME="configfile"></A> <A NAME="s11">11. Configuration File lpd.conf and Options</A></H2>

<P>The values in the LPRng configuration file
(default: <CODE>/etc/lpd.conf</CODE>)
override the compile time default values for printcap options.
See the
<A HREF="LPRng-HOWTO-21.html#index">Index To All The Configuration and Printcap Options</A>
for an index to a complete list of configuration options.
<H2><A NAME="ss11.1">11.1 Configuration File Format</A>
</H2>

<P>The LPRng distribution contains a template <CODE>lpd.conf</CODE> file
which can be installed as
<CODE>/etc/lpd.conf</CODE>.
The configuration file has the following format:
<BLOCKQUOTE><CODE>
<PRE>
# lpd.conf generated from  on Wed Apr  7 07:59:48 PDT 1999

#   The values in this file are the default values.
#   If you modify the file,  set the value to something other than the default
#   For example, '# default force_localhost' means the 'force_localhost' option
#    change this to 'force_localhost@' to have the opposite effect.

# Purpose: always print banner, ignore lpr -h option
#   default ab@
# change ---
ab
# Purpose: query accounting server when connected
#   default achk@
# Purpose: accounting at end (see also af, la, ar, as)
#   default ae=jobend $H $n $P $k $b $t
# Purpose: name of accounting file (see also la, ar)
#   default af=
...
</PRE>
</CODE></BLOCKQUOTE>
<P>The options are set exactly as for a printcap file,
but do not require a leading colon (:).
<P>To change the default value of an option,
remove the comment character and edit the entry as shown in the above example.
<P>To force the <CODE>lpd</CODE> server to use the new options,
use the <CODE>lpc reread</CODE> command.
<H2><A NAME="allowgetenv"></A> <A NAME="ss11.2">11.2 Configuration Information</A>
</H2>

<P>In order to protect system security,
the
<CODE>/etc/lpd.conf</CODE>
and
<CODE>/etc/printcap</CODE>
files should be read only.
<P>For testing purposes
when LPRng is compiled with the <CODE>-DGET_ENV</CODE> option
LPRng uses the value of the <CODE>LPD_CONF</CODE> environment variable
as the path to the <CODE>lpd.conf</CODE> file.
<B>This is a security loophole,
and should not be used when running SETUID ROOT or as ROOT.</B>
<H2><A NAME="ss11.3">11.3 Configuration Options</A>
</H2>

<P>The following variables are used to set default behavior
for the LPRng software,
or are commonly used for configuration of LPRng operations.
<H3><A NAME="defaultformat"></A> default_format</H3>

<P>Default format for printing.
Usually,
<CODE>default_format=f</CODE>,
but setting it to
<CODE>default_format=l</CODE> will cause all files spooled by lpr
to be spooled as binary files.
<H3><A NAME="defaultpermission"></A> default_permission=ACCEPT</H3>

<P>The default permissions to use when checking for printing or other permissions.
<H3><A NAME="defaultpriority"></A> default_priority=A</H3>

<P>The default priority for a print job.
<H3><A NAME="defaultremotehost"></A> default_remote_host=localhost</H3>

<P>The default <CODE>lpd</CODE> server host.
<H3><A NAME="defaulttmpdir"></A> default_tmp_dir=/tmp</H3>

<P>The default directory for temporary files.
<P>This option can be used to specify a default
printer. If no value is given (default), the first printer in the
printcap file will be used when no printer is specified.
<H3>domain_name=domain.name</H3>

<P>You will only need to set this if LPRng can't determine your
hosts domain name itself.
This is usually a desperation option when DNS or some other
database system is not available.
The value of the $USER environment variable will be used as the return address.
<H2><A NAME="forcequeuename"></A> <A NAME="usequeuename"></A> <A NAME="qq"></A> <A NAME="ss11.4">11.4 The Record Queue Name qq and force_queuename flags</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>qq</CODE><EM>&nbsp;&nbsp;Insert queue name into control file</EM></LI>
<LI> <CODE>use_queuename</CODE><EM>&nbsp;&nbsp;(alias for qq)</EM></LI>
<LI> <CODE>force_queuename=</CODE><EM>&nbsp;Queuename to be used</EM></LI>
</UL>
<P>The printcap information consists of the printer name and aliases;
when a job is spooled to a printer alias,
it is actually spooled to the main printer entry.
<P>The
<CODE>qq</CODE>
use queuename option or its
alias
<CODE>use_queuename</CODE>
tells
LPRng to record the queue name that a job was queued to,
and make it available to other software for processing.
The
<CODE>force_queuename=...</CODE>
entry forces this name to be used.
This capability has some interesting possibilities,
as shown below.
<BLOCKQUOTE><CODE>
<PRE>
pr1_landscape|pr1_portrait|pr_raw:lp=pr@host:qq
</PRE>
</CODE></BLOCKQUOTE>
<P>If a job is printed using
<CODE>lpr -Ppr1_landscape</CODE>,
then
<CODE>pr1_landscape</CODE>  will be recorded as the spool queue name
by the LPRng software.
<P>Later,
when the job is processed by a filter,
the filter will be invoked with a
<CODE>-Qpr1_landscape</CODE>
command line option.
The filter can use the name of the queue to enable say,
landscape,
portrait,
or raw
orientations.
<BLOCKQUOTE><CODE>
<PRE>
john|tom|frank:lp=pr@host:force_queuename=office
</PRE>
</CODE></BLOCKQUOTE>
<P>This printcap entry forces the queuename to be <CODE>office</CODE>;
this information could be used by a central routing facility to
process the information is a suitable manner.
<H2><A NAME="xt"></A> <A NAME="ml"></A> <A NAME="checkfornonprintable"></A> <A NAME="ss11.5">11.5 The check_for_nonprintable Flag</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>check_for_nonprintable</CODE><EM>&nbsp;&nbsp;LPR checks for non-printable file </EM></LI>
<LI> <CODE>ml=</CODE><EM>&nbsp;&nbsp;minimum number of printable characters </EM></LI>
</UL>
<P>Normally, <CODE>lpr</CODE>
checks an <CODE>f</CODE> format file
for non-printable characters (i.e., escape characters) at the start
of the print file.
Disabling this check allows you to print executable files,
etc., which can cause extreme abuse of your printer.
<P>Disabling can be done on a single printcap basis,
or you can do this on a global basis by modifying the
configuration information (see
<A HREF="#lpdconf">lpd.conf</A>).
<P>The <CODE>ml</CODE> value specifies the number of characters that
are to be checked.
Clearly,  if it is 0, none will be checked.
<H2><A NAME="rg"></A> <A NAME="ss11.6">11.6 The rg Restrict Use to Group Members Option</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>rg=</CODE><EM>Restricted group list</EM></LI>
</UL>
<P>The <CODE>rg</CODE> value specifies a list of groups.
If this value is present use of a printer or operation is restricted to only
users in a particular group.
<P>This was a wimpy attempt to do restrictions on print facilities.
The -Ppr@host option overrides this check,
unless the <CODE>rg</CODE> value is put in the LPRng defaults.
<P>However,
it does provide a simple tool to have clients do some form of permissions
checking that only the <CODE>lpd</CODE> server could normally do.
<H2><A NAME="fx"></A> <A NAME="ss11.7">11.7 The fx Allowed Formats Option</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>fx=</CODE><EM>supported formats for printing</EM></LI>
</UL>
<P>The <CODE>fx</CODE> option restricts the formats supported by
a spool queue.
The <CODE>lpr</CODE> program uses these to check if a requested format
is supported.
By default, all formats are supported.
<H2><A NAME="safechars"></A> <A NAME="ss11.8">11.8 Fixing Bad Control Files and Metacharacters</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>safe_chars=</CODE><EM>additional safe characters for control file </EM></LI>
</UL>
<P>RFC1179 defines a simple protocol and standard for print jobs to be
interchanged between print spooling systems.
Unfortunately,
there were some major mistakes in not specifying the exact form
that text would take when placed in the control file.
<P>In addition,
there are some simple coding errors that have been made,
but due to their wide distribution in major vendors software,
need to be accommodated.
See
<A HREF="#reverselpqformat">reverse_lpq_format</A>
for an example.
<P>By default,
LPRng will brutally convert a non-conforming RFC1179 control file
into one that is acceptable to most,
if not all,
existing RFC1179 implementation.
<P>In order to prevent problems with 
LPRng ruthlessly purges all characters but
upper and lower case letters,
spaces, tabs, and <CODE>-_.@/:()=,+-%</CODE> from the control file,
replacing suspicious characters with '_'.
<P>For some installations,
the default set of safe characters may be overly restrictive.
For example,
<EM>vintage</EM> software may generate files with <CODE>#</CODE> characters
in the <CODE>J</CODE> line of the control file.
The replacement of this character may cause other things to stop
working.
<P>The <CODE>safe_chars</CODE> option allows the user to specify an additional
set of safe characters in the <CODE>lpd.conf</CODE> configuration file(s).
For example, <CODE>safe_chars=#"</CODE> would allow the
<CODE>#</CODE>
and
<CODE>"</CODE>
characters to appear in the control file.
<P>In addition,
LPRng will ruthlessly regenerate control file entries and data file names
so that they are compliant with all known RFC1179 implementations.
<H2><A NAME="controlfilterbk"></A> <A NAME="bk"></A> <A NAME="ss11.9">11.9 Using the bk Option and Control File Filters</A>
</H2>

<P>Options:
<UL>
<LI> <CODE>bk</CODE><EM>&nbsp;&nbsp;Berkeley compatible control file</EM></LI>
<LI> <CODE>control_filter=</CODE><EM>Control file filter</EM></LI>
</UL>
<P>One of the more serious problems is when a print spooler (LPR) program
does not generate print jobs in a manner compatible with a remote system.
<P>While LPRng performs checks for improper implementations of RFC1179,
it will try to accept a job
even under the most severe abuse of the protocol.
However,
other spoolers are not so forgiving.
<P>Some spoolers require that the contents of the control file
be in <B>exactly</B> the order that the original 1988 BSD LPR software
generated them.
While some entries can be missing,
all the entries present in the file must be in an explicit order.
<P>The <CODE>bk</CODE> (Berkeley LPD compatible control file) option
causes LPR and LPD to reformat the control file,
removing objectionable entries.
The control file of a job being sent to
a remote printer will have its control file entries restricted to
letters in (and the same order) as  HPJCLIMWT1234.
<P>However,
there are some very odd commercial implementations that require
<EM>more</EM> information than is present.
To assist with this,
the <CODE>control_filter</CODE> option can be used.
This specifies a program that will process the control file
before it is sent to a remote destination.
See
<A HREF="LPRng-HOWTO-13.html#secfilter">Filters</A> for details on filter
operation,
and
<A HREF="LPRng-HOWTO-12.html#controlfilter">Control Filters</A> for details on the
point during job processing when the
<CODE>control_filter</CODE> 
is used.
<P>The <CODE>control_filter</CODE> program is run with the standard set of filter options.
STDIN is attached to the control file and
the STDOUT will be used as the control file value
sent to the remote host.
<P>The
<CODE>control_filter</CODE>
can rewrite the control file.
The only restriction is that it cannot modify the
<B>names</B> or delete datafiles.
Here is a small snip of PERL code that shows how to
rewrite the control file:
<BLOCKQUOTE><CODE>
<PRE>
# you need to get PERL to do a 'dup' call on FD 0
$status = 0;
@cf_lines = &lt;STDIN>;
# mess about with the control file
foreach $line (@cf_lines) {
   # or whatever you want
   print STDOUT $line;
} 
exit $status;
</PRE>
</CODE></BLOCKQUOTE>
<P>The exit code of the
<CODE>control_filter</CODE>
is used to determine whether to proceed in processing.
See
<A HREF="LPRng-HOWTO-12.html#errorcodes">Errorcodes</A> for details.
<H2><A NAME="mc"></A> <A NAME="ss11.10">11.10 Maximum Copies</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>mc#</CODE><EM>maximum copies </EM></LI>
</UL>
<P>The <CODE> mc</CODE> value specifies the maximum number of
copies of a job that can be printed on a printer using the
<CODE>lpr -Knn </CODE> or
<CODE>lpr -#nn </CODE> option.
<H2><A NAME="minfree"></A> <A NAME="ss11.11">11.11 The minfree Minimum Spool Queue Space Option</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>minfree=</CODE><EM>Size in Kbytes</EM></LI>
</UL>
<P>If this value is non-zero,
then the <CODE>lpd</CODE> receiving server checks to see that there is the
specified number of Kbytes of file space available before
accepting a job.
<H2><A NAME="useinfocache"></A> <A NAME="usedate"></A> <A NAME="syslogdevice"></A> <A NAME="mstimeresolution"></A> <A NAME="fulltime"></A> <A NAME="db"></A> <A NAME="ss11.12">11.12 Debugging</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>debugging=</CODE><EM>debugging options</EM></LI>
<LI> <CODE>full_time</CODE><EM>&nbsp;&nbsp;full or extended time format</EM></LI>
<LI> <CODE>ms_time_resolution</CODE><EM>&nbsp;&nbsp;millisecond time resolution</EM></LI>
<LI> <CODE>syslog_device=</CODE><EM>syslog alternative device</EM></LI>
<LI> <CODE>use_date</CODE><EM>&nbsp;&nbsp;put date information in control file</EM></LI>
<LI> <CODE>use_info_cache</CODE><EM>&nbsp;&nbsp;cache printcap and other information</EM></LI>
</UL>
<P>The LPRng software has a very powerful debugging capability.
Since most printing problems occur on remote systems where it is impossible
to run debuggers,  and since most systems do not do core dumps of SETUID ROOT
programs,
the LPRng software provides a very verbose set of log file trace messages.
<P>First,
serious errors or other information are logged using the
<EM>syslog()</EM> facilities.
If these are not present on a system,
then the messages are logged to the device specified by
<CODE>syslog_device</CODE>.
<P>For client programs, the debugging options are specified on the command
line and output is directed to STDERR.
For the <CODE>lpd</CODE> server,
debugging commands can be specified on the command line OR as the
<CODE>db=options</CODE> printcap value.
Output is directed to the log file (<CODE>lf</CODE> option value, default log).
<P>A typical debug entry has the format <CODE>2,network+1,database</CODE>.
This sets the general
debugging level to 2, network debugging to 1 and the database debugging level
to the default.  The following debugging options and levels are supported.
<UL>
<LI>nnn - general purpose debugging level</LI>
<LI>network - network debugging</LI>
<LI>database - database debugging</LI>
<LI>receive - job or command reception debugging</LI>
<LI>print - detailed job printing debugging</LI>
</UL>
<P>The <CODE>full_time</CODE> flag forces the logging and other information
which has timestamps to have a full (year, month, day, etc.) timestamp.
The
<CODE>ms_time_resolution</CODE> flag forces millisecond time resolution
in the time stamp.
The
<CODE>use_date</CODE> flag forces a date value to be placed in a control file
if there is none.
<P>The <CODE>use_info_cache</CODE> (default ON) causes <CODE>lpd</CODE>
to cache printcap and configuration information.
This is desirable except when trying to change values in printcap files and
test the results.
By using <CODE>use_info_cache@</CODE> in the configuration information,
you can get immediate responses.
Also, see
<A HREF="LPRng-HOWTO-18.html#lpcreread">lpc reread</A>
for another method.
<H2><A NAME="reportserveras"></A> <A NAME="spreadjobs"></A> <A NAME="spoolfileperms"></A> <A NAME="spooldirperms"></A> <A NAME="lockfile"></A> <A NAME="ipv6"></A> <A NAME="ss11.13">11.13 LPD Specific</A>
</H2>

<P>Options used:
<UL>
<LI> <CODE>ipv6</CODE><EM>&nbsp;&nbsp;use IPV6 Network facilities </EM></LI>
<LI> <CODE>lockfile=</CODE><EM>lpd server lock file</EM></LI>
<LI> <CODE>report_server_as=</CODE><EM>server name for status reports</EM></LI>
<LI> <CODE>spool_dir_perms#</CODE><EM>spool directory permissions </EM></LI>
<LI> <CODE>spool_file_perms#</CODE><EM>spool file permissions </EM></LI>
<LI> <CODE>spread_jobs#</CODE><EM>job number spread</EM></LI>
</UL>
<P>These options are usually LPD specific.
For example,
the <CODE>ipv6</CODE> specifies that the IPV6 protocol,
rather than IPV4 will be used.
In future versions,  this may not be necessary.
<P>The <CODE>lockfile</CODE> specifies the location of the
lock file used by the <CODE>lpd</CODE> server.
This file has the <CODE>lpd_port</CODE> value appended to form a unique
lock file name.
<P>The <CODE>spool_dir_perms</CODE> and <CODE>spool_file_perms</CODE>
(default 0700 and 0600 respectively)
values are the (numeric) permissions for the spool directory and
spool files.
<P>The <CODE>spread_jobs</CODE> option is obsolete.
The <CODE> spread_jobs</CODE> option was a desperation fix to handle
difficulties with the arrival of a large number of jobs with the same or
close job number.  The LPD server would fork children,
each of whom tried to lock the job files.  The spread value randomly
chose a new number in the range about the original job number.
However,
it is still preserved for legacy systems which still have problems with
file locking.
<P>The <CODE>report_server_as</CODE> option allows an administrator to
masquerade a server with another name.
This could be useful if various load sharing activities are
being carried out,  or if there are problems reconfiguring DNS
to cause the correct server name to be reported.
<H2><A NAME="ss11.14">11.14 Legacy Compatibility</A>
</H2>

<P>The following arguments have been provided for compatibility with
legacy systems.
<H3><A NAME="allowduplicateargs"></A> The allow_duplicate_args Option</H3>

<P>Options used:
<UL>
<LI> <CODE>allow_duplicate_args</CODE><EM>&nbsp;&nbsp;allow lpr to have duplicate arguments </EM></LI>
</UL>
<P>Some users would like duplicate LPR and LPRM command line
arguments to override earlier ones,
i.e. -
<CODE>lpr -a x -a y </CODE> should be equivalent to
<CODE>lpr -a y</CODE>
<P>The <CODE>allow_duplicate_args</CODE> option
allows the various client programs to have duplicate arguments.
The last specified argument on the command line will override
previous values.
<H3><A NAME="classinstatus"></A> The class_in_status Options</H3>

<P>Options used:
<UL>
<LI> <CODE>class_in_status</CODE><EM>&nbsp;&nbsp;show class name in status</EM></LI>
</UL>
<P>Setting the <CODE>class_in_status</CODE> option causes the class name rather
than priority to be displayed in the status information.
<H3><A NAME="reverselpqformat"></A> The reverse_lpq_format Option</H3>

<P>Options used:
<UL>
<LI> <CODE>reverse_lpq_format=</CODE><EM>&nbsp;reverse LPQ status format for specified remote systems</EM></LI>
</UL>
<P>Various Solaris and other System V implementations support an RFC1179 interface
to remote printers.
Unfortunately,  there is a problem in that when they send a status request,
the status format is reversed.
That is,
when LONG status format is wanted,
they send SHORT,
and vice versa.
<P>The <CODE>reverse_lpq_format=</CODE> specifies a list of printers or IP addresses
for which the <CODE>lpd</CODE> server will return LONG status when SHORT is
requested,
and vice versa.
For example:
<BLOCKQUOTE><CODE>
<PRE>
reverse_lpq_format=*.eng.com,130.192.0.0/16
</PRE>
</CODE></BLOCKQUOTE>
<P>will cause hosts whose Fully Qualified Domain Name (FQDN) ends in
<CODE>eng.com</CODE> or from subnet <CODE>130.192.0.0</CODE> to have reversed
status returned.
<H3><A NAME="returnshortstatus"></A> <A NAME="shortstatuslength"></A> The return_short_status and short_status_length Options</H3>

<P>Options used:
<UL>
<LI> <CODE>return_short_status=</CODE><EM>&nbsp;return short LPQ status for specified remote systems</EM></LI>
<LI> <CODE>short_status_length#</CODE><EM>&nbsp;short LPQ status length in lines</EM></LI>
</UL>
<P>In order to be compatible with non-LPRng client programs,
some administrators would like <CODE>lpd</CODE> to return a short or brief
status to normal status queries.
<P>The <CODE>return_short_status=</CODE> specifies a list of printers or IP addresses
for which the <CODE>lpd</CODE> server will return an abbreviated
status when LONG status is requested.
For example:
<BLOCKQUOTE><CODE>
<PRE>
return_short_status=*.eng.com,130.192.0.0/16
short_status_length#3
</PRE>
</CODE></BLOCKQUOTE>
<P>will cause hosts whose Fully Qualified Domain Name (FQDN) ends in
<CODE>eng.com</CODE> or from subnet <CODE>130.192.0.0</CODE> to get only
3 lines of detailed status returned.
<H3><A NAME="forcelpqstatus"></A> The force_lpq_status Options</H3>

<P>Options used:
<UL>
<LI> <CODE>force_lpq_status=</CODE><EM>&nbsp;force LPQ status format for specified remote systems</EM></LI>
</UL>
<P>In order to be compatible with non-LPRng client programs which
are totally unpredictable,
this allows the administrator to specify the format for LPQ
status when requests arrive.
<P>The <CODE>force_lpq_status=</CODE> specifies a list of formats
and printers or IP addresses
for which the <CODE>lpd</CODE> server will return status
in the specified format.
The entry has the format
<CODE>KEY=list;KEY=list...</CODE> where
<CODE>KEY</CODE> is
<CODE>s</CODE> for short and
<CODE>l</CODE> for long format,
and list is a list of hosts or IP addresses.
For example:
<BLOCKQUOTE><CODE>
<PRE>
force_lpq_status=s=pc*.eng.com,130.192.12.0/24,l=sun*.eng.com
</PRE>
</CODE></BLOCKQUOTE>
<P>will cause hosts whose Fully Qualified Domain Name (FQDN) matches
<CODE>pc*eng.com</CODE> or from subnet <CODE>130.192.12.0</CODE> to get short
status returned and hosts which match <CODE>sun*.eng.com</CODE> get
long status.
<H3><A NAME="forcefqdnhostname"></A> <A NAME="ignorerequesteduserpriority"></A> The ignore_requested_user_priority and force_fqdn_hostname Options</H3>

<P>Options used:
<UL>
<LI><CODE>ignore_requested_user_priority</CODE><EM>prevent users from queue jumping</EM></LI>
<LI><CODE>force_fqdn_hostname</CODE><EM>force FQDN hostname in control file</EM></LI>
</UL>
<P>Some students... um... users... will request a high priority for their job
in order to jump the queue of waiting jobs.
This option will cause the <CODE>lpd</CODE> server to ignore the
requested user priority.
However, the <CODE>topq</CODE> operation will still be effective.
<P>Similarly,  some print spoolers do not put a FQDN host name in their control file.
The <CODE>force_fqdn_hostname</CODE> flag will cause <CODE>lpd</CODE> to put a FQDN
host name in the control file.
This option will assume that the domain is where the connection originated from.
<H3><A NAME="lprbsd"></A> The lpr_bsd Options</H3>

<P>This will force the <CODE>lpr -m</CODE> (send mail to user)
option not to take an argument, as in the BSD lpr.
<HR>
<A HREF="LPRng-HOWTO-12.html">Next</A>
<A HREF="LPRng-HOWTO-10.html">Previous</A>
<A HREF="LPRng-HOWTO.html#toc11">Contents</A>
</BODY>
</HTML>
