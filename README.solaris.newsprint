From majordomo-owner@iona.com Thu Aug 29 15:47:02 1996
Received: from dublin.iona.ie (majordom@operation.dublin.iona.ie [192.122.221.5]) by dickory.sdsu.edu (8.6.10/8.6.10) with ESMTP id PAA27089 for <papowell@dickory.SDSU.Edu>; Thu, 29 Aug 1996 15:46:58 -0700
Received: (majordom@localhost) by dublin.iona.ie (8.7.5/jm-1.01) id XAA13875 for plp-outgoing; Thu, 29 Aug 1996 23:50:24 +0100 (BST)
Received: from watson.eecs.berkeley.edu (watson.EECS.Berkeley.EDU [128.32.240.184]) by dublin.iona.ie (8.7.5/jm-1.01) with ESMTP id XAA13868 for <plp@iona.com>; Thu, 29 Aug 1996 23:50:16 +0100 (BST)
Received: from watson.eecs.berkeley.edu (cxh@localhost) by watson.eecs.berkeley.edu (8.7.5/8.7.3) with ESMTP id PAA01864 for <plp@iona.com>; Thu, 29 Aug 1996 15:49:43 -0700 (PDT)
From: Christopher Hylands <cxh@EECS.Berkeley.EDU>
Message-Id: <199608292249.PAA01864@watson.eecs.berkeley.edu>
To: plp@iona.com
Subject: LPRng installation answers: Solaris, Newsprint, Framemaker
Date: Thu, 29 Aug 1996 15:49:43 -0700
Sender: majordomo-owner@iona.com
Precedence: bulk
Reply-To: plp@iona.com
Status: R


Below are some notes from my installation of LPRng.  These notes are
available via http://ptolemy.eecs.berkeley.edu/~cxh/lprng.html.  I'll
probably update that page as I find out more goodies, so if you are
looking at this from the archives, you might want to check the page.

Looking through the mailing list logs, it looks like everyone was
having a hard time getting lprng to work with Sun's braindead
newsprinters.  I tried using ghostscript, but the fonts were, IMHO,
ugly, so I spent a little time getting the newsprint fonts to work.

The key thing was to grab the file /usr/newsprint/lpd/if from a
SunOS4.1.3 newsprint installation.

I'm still getting bit by a problem with the exit code in lpr being
non-zero, which causes ghostview to pop up a message box.  This sounds
like it will be truly fixed shortly.

Here are the notes:

---start---

Installation

To install lprng on a Solaris2.x machine, use the lprngsetup script,
reproduced below. Note that if there is a local printer, you may have
to also fix the permissions of the device. Typical commands are:

	chown daemon /devices/sbus@1,f8000000/SUNW,lpvi@1,300000:lpvi0

Here's lprngsetup 

---start of lprngsetup---
#! /bin/sh
# Script to disable Solaris printing and setup for LPRng

rm -f /etc/rc2.d/S80lp
cd /etc/init.d
rm -f lprng
ln -s ../../usr/cluster/etc/init.d/lprng
cd /etc/rc0.d
rm -f K20lprng
ln  ../init.d/lprng K20lprng
cd /etc/rc2.d
rm -f K20lprng
ln  ../init.d/lprng K20lprng
rm -f S80lprng
ln  ../init.d/lprng S80lprng
if [ ! -d /var/spool/lpd ]; then
        mkdir /var/spool/lpd
        chown daemon /var/spool/lpd     
fi


/usr/sbin/lpshut

sleep 2
/usr/sbin/nlsadmin -r lpd tcp
/usr/sbin/nlsadmin -r lp tcp

/etc/init.d/lprng start
sleep 2
# Fix permissions, create directories
/usr/tools/tools2/lprng/bin/checkpc -f

---end of lprngsetup---

LPRng and the Textronix PhaserII
--------------------------------
We use the following simple filter named cpsif 

#! /bin/sh
#
echo -n "cpsif: start PS file " 1>&2
date 1>&2
echo "Args are:'$*'" 1>&2
cat
echo -n "cpsif: end PS file   " 1>&2
date 1>&2



LPRng and NeWSprint
-------------------
The Sparcprinters use licensed fonts from NeWSsprint. To use the licensed fonts, you must have the lprng
spool directory for the sparcprinter in the same location as spool directory of the brain dead Solaris lp system.
If your printer is named xsp524, then this directory would be /etc/lp/printers/xsp524 

The printcap entry lookes like: 

sp524|524:\
        :mx#0:sf:sh:sb:\
        :lp=:rm=doppler:rp=xsp524:mx#0: \
        :sd=/var/spool/lpd/sp524d:\
        :lf=/var/spool/lpd/sp524d/log:

xsp524|Sun SPARCprinter NeWSprint printer:
        :mx#0:sf:sb:sh:rs:
        :lp=/dev/lpvi0:
        :sd=/etc/lp/printers/xsp524:
        :lf=/etc/lp/printers/xsp524/log:
        :af=/var/spool/lpd/xsp524/acct:
        :if=/usr/local/lib/newsprint/if:


/usr/local/lib/newsprint/if was copied from /usr/newsprint/lpd/if
which was in a SunOS4.x installation of the newsprint
software. Unfortunately, the newsprint engine is so brain dead that it
needs many environment variables set, so it is fairly difficult to
come up with a clean script to start the engine. I made the following
changes:

cxh@watson 7% diff -c if /usr/local/lib/newsprint/if
*** if  Mon Aug 26 18:59:40 1996
--- /usr/local/lib/newsprint/if Wed Aug 21 11:10:29 1996
***************
*** 30,42 ****
        exit $1
  }
  
! PATH=/usr/ucb:/usr/bin:/etc:/usr/etc
  FILTERNAME=`basename $0`
  PARAM=.param
  ARCH=`arch`; export ARCH
  # execute the printer's .param file in the current/spool directory
  . ./$PARAM
  PATH=$PATH:$NPHOME/pl.$ARCH/bin:$NPHOME/np/bin; export PATH
  JOBDATA=job.data; export JOBDATA
  ERRFILTER=`dir_name $0`/errfilter
  
--- 30,45 ----
        exit $1
  }
  
! PATH=/usr/ucb:/usr/bin:/etc:/usr/etc:/opt/NeWSprint/bin:/opt/NeWSprint/np/bin:
  FILTERNAME=`basename $0`
  PARAM=.param
+ #PL_PATH=/usr/newsprint/pl.sun4:/usr/newsprint/pl.sun4/C/ps
  ARCH=`arch`; export ARCH
  # execute the printer's .param file in the current/spool directory
  . ./$PARAM
+ 
  PATH=$PATH:$NPHOME/pl.$ARCH/bin:$NPHOME/np/bin; export PATH
+ 
  JOBDATA=job.data; export JOBDATA
  ERRFILTER=`dir_name $0`/errfilter
  
***************
*** 86,101 ****
        PL='pl --m 3'
        set -x
  else
!       PL=pl
  fi
  
  parm_line=$@
! while getopts w:l:ci:n:h:x:y: OPTN
  do
        case $OPTN in
                \?)
!                       echo "$FILTERNAME\: illegal option" >>2
!                       Exit 2
                        ;;
  
                w | x)
--- 89,108 ----
        PL='pl --m 3'
        set -x
  else
!     # trace the system calls
!     # PL='truss -f -a -rall -wall -o /tmp/tr pl --e ""'
!     PL='pl --e \"\"'
  fi
  
  parm_line=$@
! 
! while getopts w:l:ci:n:h:x:y:C:F:H:J:L:P:a OPTN
  do
        case $OPTN in
+               C | F | H | J | L | P) ;;
                \?)
!                       #echo "$FILTERNAME\: illegal option" >>2
!                       #Exit 2
                        ;;
  
                w | x)
***************
*** 136,142 ****
  
  # PreLimn commands for backward compatibility with the older
  # param files.
! IFCMD1OLD=":rev $STACKORDER -T $NPTMP :separator :npcomm"
  IFCMD2OLD=":rev $STACKORDER -T $NPTMP :npcomm"
  VFCMD1OLD=":npcomm"
  VFCMD2OLD="--k ps < /dev/null :separator :npcomm"
--- 143,153 ----
  
  # PreLimn commands for backward compatibility with the older
  # param files.
! #IFCMD1OLD=":rev $STACKORDER -T $NPTMP :separator :npcomm"
! 
! # Turn off the banner
! IFCMD1OLD=":rev $STACKORDER -T $NPTMP :npcomm"
! 
  IFCMD2OLD=":rev $STACKORDER -T $NPTMP :npcomm"
  VFCMD1OLD=":npcomm"
  VFCMD2OLD="--k ps < /dev/null :separator :npcomm"
cxh@watson 8% 

You will also need a /etc/lp/printers/printername/.params file. If you
are using the same spooler directory as the directory that the Solaris
lp system uses, then the .param file should appear there. If you are
using a different spooler directory, then you will need to copy the
.param file from elsewhere and edit it accordingly.

Newsprint font licensing
------------------------

If you are going to move a license to a new printer, you should
probably save the .param file in the old printer spooler
directory. Run /opt/NeWSprint/bin/fp_install and remove the license
from the old printer and assign it to the new printer.

You could run /opt/NeWSprint/bin/rm_np_printer and remove the printer,
but that will get rid of the .param file

LPRng and Framemaker under Solaris2.x
-------------------------------------

Framemaker under Solaris2.x uses the lp command. The fix is to edit
$FMHOME/fminit/FMlpr and comment out the lp line and add an lpr line

            sunxm.s5.sparc)
                lpr -P"$PRINTER" "$FILE"
                #lp -c -d"$PRINTER" "$FILE"



--end--

-Christopher

Christopher Hylands, Ptolemy Project Manager  University of California
cxh@eecs.berkeley.edu 			      US Mail: 558 Cory Hall #1770
ph: (510)643-9841 fax:(510)642-2739	      Berkeley, CA 94720-1770
home: (510)526-4010 (if busy -4068)	      (Office: 493 Cory)

